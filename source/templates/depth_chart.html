{% extends "base.html" %}

{% block content %}
{% set team_fullnames = {
    'ARI': 'Arizona Cardinals',
    'ATL': 'Atlanta Falcons',
    'BAL': 'Baltimore Ravens',
    'BUF': 'Buffalo Bills',
    'CAR': 'Carolina Panthers',
    'CHI': 'Chicago Bears',
    'CIN': 'Cincinnati Bengals',
    'CLE': 'Cleveland Browns',
    'DAL': 'Dallas Cowboys',
    'DEN': 'Denver Broncos',
    'DET': 'Detroit Lions',
    'GB': 'Green Bay Packers',
    'HOU': 'Houston Texans',
    'IND': 'Indianapolis Colts',
    'JAX': 'Jacksonville Jaguars',
    'KC': 'Kansas City Chiefs',
    'LV': 'Las Vegas Raiders',
    'LAC': 'Los Angeles Chargers',
    'LAR': 'Los Angeles Rams',
    'MIA': 'Miami Dolphins',
    'MIN': 'Minnesota Vikings',
    'NE': 'New England Patriots',
    'NO': 'New Orleans Saints',
    'NYG': 'New York Giants',
    'NYJ': 'New York Jets',
    'PHI': 'Philadelphia Eagles',
    'PIT': 'Pittsburgh Steelers',
    'SF': 'San Francisco 49ers',
    'SEA': 'Seattle Seahawks',
    'TB': 'Tampa Bay Buccaneers',
    'TEN': 'Tennessee Titans',
    'WSH': 'Washington Commanders'
} %}
<style>
    .team-logo {
        width: 32px;
        height: 32px;
        object-fit: contain;
    }
    .team-fullname {
        font-size: 0.8rem;
        font-weight: 500;
    }
    .card-header {
        padding: 0.75rem 1rem;
        color: white;
        border: none;
        box-shadow: none;
        position: relative;
        overflow: hidden;
    }
    .card-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, var(--team-primary) 0%, var(--team-secondary) 100%);
        z-index: 0;
        opacity: 0.9;
    }
    .card-header > * {
        position: relative;
        z-index: 1;
    }
</style>
<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="page-header mb-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="display-5 fw-bold mb-2">NFL Depth Charts</h1>
                <p class="lead text-muted mb-0">Explore team rosters and player positions for the current season</p>
            </div>
            <div>
                <a href="/" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left me-2"></i> Back to Home
                </a>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="card mb-4">
            <div class="card-body p-3">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="teamFilter" class="form-label">Filter by Team</label>
                        <select class="form-select" id="teamFilter">
                            <option value="">All Teams</option>
                            {% for team in team_names %}
                            <option value="{{ team }}">{{ team }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="positionFilter" class="form-label">Filter by Position</label>
                        <select class="form-select" id="positionFilter">
                            <option value="">All Positions</option>
                            <option value="QB">Quarterback</option>
                            <option value="RB">Running Back</option>
                            <option value="WR">Wide Receiver</option>
                            <option value="TE">Tight End</option>
                            <option value="OL">Offensive Line</option>
                            <option value="DL">Defensive Line</option>
                            <option value="LB">Linebacker</option>
                            <option value="DB">Defensive Back</option>
                            <option value="ST">Special Teams</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="searchInput" class="form-label">Search Players</label>
                        <div class="input-group">
                            <span class="input-group-text bg-transparent border-end-0">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control border-start-0" id="searchInput" placeholder="Search players...">
                        </div>
                    </div>
                </div>
            </div>
        </div>
                
                <!-- Team Selection -->
                <div class="d-flex align-items-center justify-content-between mb-4">
                    <h2 class="h4 mb-0">Team Rosters</h2>
                </div>
                
                <!-- Team Grid -->
                <div id="teamGrid" class="row g-4">
                    {% for team, players in teams_data.items() %}
                    <div class="col-xl-3 col-lg-4 col-md-6 team-card" data-team="{{ team }}">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header" style="--team-primary: {{ team_colors[team].primary }}; --team-secondary: {{ team_colors[team].secondary }}; background: linear-gradient(90deg, {{ team_colors[team].primary }} 0%, {{ team_colors[team].secondary }} 100%);">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div class="d-flex align-items-center">
                                        {% set team_name = team_fullnames.get(team, team).replace(' ', '_') %}
                                        <img src="{{ url_for('static', filename='images/teams/' + team_name + '_logo.svg') }}" 
                                             alt="{{ team }} logo" 
                                             class="team-logo me-2"
                                             data-fallback-src="{{ url_for('static', filename='images/teams/default_logo.svg') }}"
                                             onerror="this.onerror=null; this.src=this.dataset.fallbackSrc">
                                        <div>
                                            <div class="team-fullname fw-medium">{{ team_fullnames.get(team, team) }}</div>
                                            <div class="text-white-50 small">{{ team }}</div>
                                        </div>
                                    </div>
                                    <span class="badge bg-white text-dark rounded-pill">{{ players|length }} players</span>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <ul class="list-group list-group-flush">
                                    {% set position_groups = {
                                        'QB': 'Quarterback',
                                        'RB': 'Running Back',
                                        'WR': 'Wide Receiver',
                                        'TE': 'Tight End',
                                        'OL': 'Offensive Line',
                                        'DL': 'Defensive Line',
                                        'LB': 'Linebacker',
                                        'DB': 'Defensive Back',
                                        'ST': 'Special Teams'
                                    } %}
                                    
                                    {% for pos_code, pos_name in position_groups.items() %}
                                        {% set pos_players = players|selectattr('position', 'equalto', pos_code)|list %}
                                        {% if pos_players|length > 0 %}
                                            <li class="list-group-item bg-transparent position-relative">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <span class="fw-bold small text-uppercase text-muted">{{ pos_name }}</span>
                                                    <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill">{{ pos_players|length }}</span>
                                                </div>
                                                <div class="mt-2">
                                                    {% for player in pos_players|sort(attribute='depth_team') %}
                                                        <div class="d-flex align-items-center py-1 player-row" data-position="{{ pos_code }}">
                                                            <span class="badge bg-primary bg-opacity-10 text-primary me-2">{{ player.depth_team }}</span>
                                                            <div class="d-flex align-items-center flex-grow-1">
                                                                <a href="{{ url_for('player_stats', player_name=player.full_name) }}" class="text-decoration-underline fw-medium text-primary">
                                                                    {{ player.full_name }}
                                                                    <i class="bi bi-box-arrow-up-right ms-1 small text-muted"></i>
                                                                </a>
                                                                {% if player.jersey_number %}
                                                                    <small class="text-muted ms-auto">#{{ player.jersey_number }}</small>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            </div>

                        </div>
                    </div>
                    {% endfor %}
                </div>
                

                

    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Team filtering functionality
        const teamFilter = document.getElementById('teamFilter');
        const positionFilter = document.getElementById('positionFilter');
        const searchInput = document.getElementById('searchInput');
        const teamCards = document.querySelectorAll('.team-card');
        const playerRows = document.querySelectorAll('.player-row');
        
        // Function to filter teams based on filters
        function filterTeams() {
            const selectedTeam = teamFilter.value.toLowerCase();
            const selectedPosition = positionFilter.value;
            const searchTerm = searchInput.value.toLowerCase();
            
            teamCards.forEach(card => {
                const teamName = card.getAttribute('data-team').toLowerCase();
                let teamMatches = !selectedTeam || teamName.includes(selectedTeam);
                
                // Check if any player in the team matches the position and search term
                const playerElements = card.querySelectorAll('.player-row');
                
                playerElements.forEach(playerEl => {
                    const position = playerEl.getAttribute('data-position');
                    const playerName = playerEl.textContent.toLowerCase();
                    
                    const positionMatch = !selectedPosition || position === selectedPosition;
                    const searchMatch = !searchTerm || playerName.includes(searchTerm);
                    
                    if (positionMatch && searchMatch) {
                        playerEl.style.display = 'flex';
                    } else {
                        playerEl.style.display = 'none';
                    }
                });
                
                // Show/hide position groups based on visible players
                const positionGroups = card.querySelectorAll('.list-group-item');
                positionGroups.forEach(group => {
                    const visiblePlayers = group.querySelectorAll('.player-row[style="display: flex;"]').length;
                    if (visiblePlayers > 0) {
                        group.style.display = 'block';
                    } else {
                        group.style.display = 'none';
                    }
                });
                
                // Show/hide team card based on filters
                const hasVisiblePositionGroups = Array.from(card.querySelectorAll('.list-group-item'))
                    .some(el => el.style.display !== 'none');
                
                if (teamMatches && (hasVisiblePositionGroups || (!selectedPosition && !searchTerm))) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        teamFilter.addEventListener('change', filterTeams);
        positionFilter.addEventListener('change', filterTeams);
        searchInput.addEventListener('input', filterTeams);
        

    });
</script>
{% endblock %}
